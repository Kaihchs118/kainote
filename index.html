<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>KAI STUDIO</title>
    <style>
        /* --- åŸºæœ¬æ¨£å¼èˆ‡æš—é»‘ä¸»é¡Œ --- */
        :root {
            --bg-color: #121212;
            --text-color: #e0e0e0;
            --editor-bg-color: #1e1e1e;
            --border-color: #333;
            --link-color: #8ab4f8;
            --code-bg-color: #2d2d2d;
        }
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            margin: 0;
            padding: 2rem;
            background-color: var(--bg-color);
            color: var(--text-color);
            display: flex;
            justify-content: center;
        }
        .container {
            width: 100%;
            max-width: 800px;
        }

        /* --- ç·¨è¼¯å™¨æ¨£å¼ (admin æ¨¡å¼) --- */
        #editor {
            width: 100%;
            height: 80vh;
            background-color: var(--editor-bg-color);
            color: var(--text-color);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 1.5rem;
            font-size: 16px;
            line-height: 1.6;
            box-sizing: border-box; /* ç¢ºä¿ padding ä¸æœƒå½±éŸ¿å¯¬åº¦ */
            resize: vertical;
            display: none; /* é è¨­éš±è— */
            font-family: "SF Mono", "Courier New", monospace;
        }
        #editor:focus {
            outline: none;
            border-color: var(--link-color);
            box-shadow: 0 0 5px rgba(138, 180, 248, 0.5);
        }

        /* --- Markdown æ¸²æŸ“å¾Œçš„å…§å®¹æ¨£å¼ --- */
        .markdown-body {
            line-height: 1.7;
            word-wrap: break-word;
        }
        .markdown-body h1, .markdown-body h2, .markdown-body h3 {
            border-bottom: 1px solid var(--border-color);
            padding-bottom: .3em;
            margin-top: 24px;
            margin-bottom: 16px;
        }
        .markdown-body h1 { font-size: 2em; }
        .markdown-body h2 { font-size: 1.5em; }
        .markdown-body h3 { font-size: 1.25em; }
        .markdown-body a {
            color: var(--link-color);
            text-decoration: none;
        }
        .markdown-body a:hover {
            text-decoration: underline;
        }
        .markdown-body p {
            margin-top: 0;
            margin-bottom: 16px;
        }
        .markdown-body ul, .markdown-body ol {
            padding-left: 2em;
        }
        .markdown-body code {
            padding: .2em .4em;
            margin: 0;
            font-size: 85%;
            background-color: var(--code-bg-color);
            border-radius: 6px;
            font-family: "SF Mono", "Courier New", monospace;
        }
        .markdown-body pre {
            background-color: var(--code-bg-color);
            padding: 16px;
            border-radius: 6px;
            overflow: auto;
        }
        .markdown-body pre code {
            padding: 0;
            margin: 0;
            font-size: 100%;
            background-color: transparent;
        }
        .markdown-body blockquote {
            border-left: .25em solid var(--border-color);
            color: #999;
            padding: 0 1em;
            margin-left: 0;
        }
        .markdown-body img {
            max-width: 100%;
        }
        .markdown-body table {
            border-collapse: collapse;
        }
        .markdown-body th, .markdown-body td {
            border: 1px solid var(--border-color);
            padding: 6px 13px;
        }

        /* --- è®€å–ä¸­æç¤º --- */
        .loading-text::before {
            content: 'Loading content from database...';
            color: #777;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- é¡¯ç¤ºæ¸²æŸ“å¾Œ Markdown å…§å®¹çš„åœ°æ–¹ -->
        <div id="content" class="markdown-body loading-text"></div>
        <!-- åªæœ‰ admin å¯ä»¥çœ‹åˆ°çš„ç·¨è¼¯å™¨ -->
        <textarea id="editor" spellcheck="false"></textarea>
    </div>

    <!-- å¼•å…¥ marked.js ç”¨æ–¼ Markdown -> HTML è½‰æ› -->
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>

    <!-- å¼•å…¥ Firebase SDK ä¸¦åŸ·è¡Œæˆ‘å€‘çš„é‚è¼¯ -->
    <script type="module">
        // 1. å¼•å…¥ Firebase SDK çš„å¿…è¦å‡½å¼
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.1/firebase-app.js";
        import { getDatabase, ref, onValue, set } from "https://www.gstatic.com/firebasejs/9.22.1/firebase-database.js";

        // 2. ğŸ”¥ğŸ”¥ğŸ”¥ éå¸¸é‡è¦ï¼šè«‹å°‡åº•ä¸‹æ›æˆä½ è‡ªå·±çš„ Firebase è¨­å®š ğŸ”¥ğŸ”¥ğŸ”¥
        // Import the functions you need from the SDKs you need
    const firebaseConfig = {
  apiKey: "AIzaSyAKiC62bh50NXLMWwbfNHekmVCBtTtam6Y",
  authDomain: "blog-63ad2.firebaseapp.com",
  projectId: "blog-63ad2",
  storageBucket: "blog-63ad2.firebasestorage.app",
  messagingSenderId: "265914768921",
  appId: "1:265914768921:web:e4c752780e604d0be69488",
  measurementId: "G-7916V6HGTV"
};

// Initialize Firebase
const app = initializeApp(firebaseConfig);
const analytics = getAnalytics(app);
        };
        // ğŸ”¥ğŸ”¥ğŸ”¥ ä¸Šæ–¹çš„ firebaseConfig å‹™å¿…æ›¿æ› ğŸ”¥ğŸ”¥ğŸ”¥

        // 3. åˆå§‹åŒ– Firebase App èˆ‡è³‡æ–™åº«
        const app = initializeApp(firebaseConfig);
        const database = getDatabase(app);
        
        // æˆ‘å€‘å°‡æ–‡ä»¶å…§å®¹å„²å­˜åœ¨è³‡æ–™åº«çš„ 'live-doc/content' é€™å€‹è·¯å¾‘ä¸‹
        const docRef = ref(database, 'live-doc/content');

        // 4. å–å¾—é é¢ä¸Šçš„ HTML å…ƒç´ 
        const contentDiv = document.getElementById('content');
        const editorTextarea = document.getElementById('editor');

        // 5. æª¢æŸ¥ç¶²å€åƒæ•¸ï¼Œåˆ¤æ–·æ˜¯å¦ç‚º Admin æ¨¡å¼
        const params = new URLSearchParams(window.location.search);
        const isAdmin = params.get('admin') === '1';

        // é è¨­çš„æ­¡è¿æ–‡å­—
        const defaultText = "# æ­¡è¿ä½¿ç”¨ï¼\n\né€™æ˜¯ä¸€å€‹å³æ™‚å”ä½œçš„ Markdown é é¢ã€‚\n\n- åœ¨ç¶²å€åˆ—åŠ ä¸Š `?admin=1` é€²å…¥ç·¨è¼¯æ¨¡å¼ã€‚\n- æ”¯æ´æ¨™æº– Markdown èªæ³•ï¼Œä¾‹å¦‚ [é€™æ˜¯ä¸€å€‹é€£çµ](https://www.google.com)ã€‚\n- æ‰€æœ‰å…§å®¹éƒ½æœƒå³æ™‚åŒæ­¥çµ¦æ‰€æœ‰è¨ªå®¢ã€‚";
        
        // æ ¹æ“šæ˜¯å¦ç‚º Adminï¼Œæ±ºå®šé¡¯ç¤ºç·¨è¼¯å™¨é‚„æ˜¯é è¦½å€å¡Š
        if (isAdmin) {
            editorTextarea.style.display = 'block';
        } else {
            contentDiv.style.display = 'block';
        }

        // ç‚ºç·¨è¼¯å™¨åŠ ä¸Šè¼¸å…¥ç›£è½äº‹ä»¶ï¼Œåªæœ‰ Admin æ‰éœ€è¦
        if (isAdmin) {
            editorTextarea.addEventListener('input', () => {
                // ä½¿ç”¨ debounce é˜²æ­¢éæ–¼é »ç¹åœ°å¯«å…¥è³‡æ–™åº«
                // (é›–ç„¶ Firebase å¯ä»¥è™•ç†ï¼Œä½†é€™æ˜¯å€‹å¥½ç¿’æ…£)
                clearTimeout(window.firebaseTimeout);
                window.firebaseTimeout = setTimeout(() => {
                    set(docRef, editorTextarea.value);
                }, 250); // å»¶é² 250 æ¯«ç§’å¯«å…¥
            });
        }

        // 6. ç›£è½è³‡æ–™åº«çš„è®ŠåŒ– (å°æ‰€æœ‰ä½¿ç”¨è€…éƒ½æœ‰æ•ˆ)
        onValue(docRef, (snapshot) => {
            // å¾è³‡æ–™åº«å¿«ç…§ä¸­å–å¾—æ–‡å­—ï¼Œå¦‚æœè³‡æ–™åº«æ˜¯ç©ºçš„ï¼Œå°±ä½¿ç”¨é è¨­æ–‡å­—
            const text = snapshot.val();
            const currentContent = text === null ? defaultText : text;

            // ç§»é™¤ Loading æç¤º
            if (contentDiv.classList.contains('loading-text')) {
                contentDiv.classList.remove('loading-text');
            }

            // ä½¿ç”¨ marked.js å°‡ Markdown æ–‡å­—è½‰æ›æˆ HTML
            const renderedHtml = marked.parse(currentContent);

            // å°‡è½‰æ›å¾Œçš„ HTML æ›´æ–°åˆ°å…¬é–‹çš„é è¦½å€å¡Š
            contentDiv.innerHTML = renderedHtml;

            // å¦‚æœæ˜¯ Adminï¼Œä¹Ÿè¦åŒæ­¥æ›´æ–°ç·¨è¼¯å™¨çš„å…§å®¹
            // (é€™èƒ½ç¢ºä¿å¤šå€‹ Admin åŒæ™‚ç·¨è¼¯æ™‚ï¼Œç•«é¢æœƒåŒæ­¥)
            // ä¸¦åŠ ä¸Šæª¢æŸ¥ï¼Œé¿å…è‡ªå·±æ›´æ–°è‡ªå·±å°è‡´æ¸¸æ¨™è·³å‹•
            if (isAdmin && editorTextarea.value !== currentContent) {
                editorTextarea.value = currentContent;
            }
        });

    </script>
</body>
</html>
